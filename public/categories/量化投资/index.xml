<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>量化投资 on R-Finance中国</title><link>https://rfinance.org.cn/categories/%E9%87%8F%E5%8C%96%E6%8A%95%E8%B5%84/</link><description>Recent content in 量化投资 on R-Finance中国</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Tue, 10 Jun 2025 15:36:25 +0000</lastBuildDate><atom:link href="https://rfinance.org.cn/categories/%E9%87%8F%E5%8C%96%E6%8A%95%E8%B5%84/index.xml" rel="self" type="application/rss+xml"/><item><title>KDJ指标择时交易策略分析</title><link>https://rfinance.org.cn/post/kdj/</link><pubDate>Tue, 10 Jun 2025 15:36:25 +0000</pubDate><guid>https://rfinance.org.cn/post/kdj/</guid><description>&lt;h1 id="引言">引言&lt;/h1>
&lt;p>技术分析是金融市场中常用的分析方法，其中KDJ指标是一种重要的随机指标，能够反映价格波动的强弱、超买超卖现象以及市场趋势变化。本研究旨在通过R语言实现基于KDJ指标的股票择时交易策略，并通过历史数据回测寻找最佳参数组合。&lt;/p>
&lt;h1 id="研究方法">研究方法&lt;/h1>
&lt;h2 id="数据获取与处理">数据获取与处理&lt;/h2>
&lt;p>我们将使用&lt;code>quantmod&lt;/code>包获取股票数据，并使用&lt;code>quantstrat&lt;/code>包进行策略回测。首先加载所需的包：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载必要的包&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantmod)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantstrat)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(eTTR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(PerformanceAnalytics)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(ggplot2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(tibble)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(scales)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(gridExtra)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载环境重置函数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">source&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/Users/matrixspk/My-Sites/r-finance/assets/code/reset_strategy_env.R&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载计算胜率的函数&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">source&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/Users/matrixspk/My-Sites/r-finance/assets/code/calculate_portfolio_win_rates.R&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">source&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/Users/matrixspk/My-Sites/r-finance/assets/code/generateSimpleSignalChain.R&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>接下来，我们获取苹果公司股票的历史数据作为研究对象：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置获取数据的起始和结束日期&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>initDate &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2017-12-31&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>startdate.st &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2018-01-01&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enddate.st &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2023-06-01&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取苹果公司股票数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">getSymbols&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;AAPL&amp;#34;&lt;/span>, src &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;yahoo&amp;#34;&lt;/span>, from &lt;span style="color:#f92672">=&lt;/span> startdate.st, to &lt;span style="color:#f92672">=&lt;/span> enddate.st)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## [1] &amp;#34;AAPL&amp;#34;
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">colnames&lt;/span>(AAPL) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Open&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;High&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Low&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Close&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Volume&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Adjusted&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看数据结构&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">head&lt;/span>(AAPL)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Open High Low Close Volume Adjusted
## 2018-01-02 42.5400 43.0750 42.3150 43.0650 102223600 40.42682
## 2018-01-03 43.1325 43.6375 42.9900 43.0575 118071600 40.41978
## 2018-01-04 43.1350 43.3675 43.0200 43.2575 89738400 40.60753
## 2018-01-05 43.3600 43.8425 43.2625 43.7500 94640000 41.06987
## 2018-01-08 43.5875 43.9025 43.4825 43.5875 82271200 40.91733
## 2018-01-09 43.6375 43.7650 43.3525 43.5825 86336000 40.91262
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">summary&lt;/span>(AAPL)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Index Open High Low 
## Min. :2018-01-02 Min. : 35.99 Min. : 36.43 Min. : 35.50 
## 1st Qu.:2019-05-10 1st Qu.: 51.97 1st Qu.: 52.32 1st Qu.: 51.67 
## Median :2020-09-15 Median :114.67 Median :116.07 Median :112.84 
## Mean :2020-09-14 Mean :102.38 Mean :103.62 Mean :101.24 
## 3rd Qu.:2022-01-20 3rd Qu.:146.36 3rd Qu.:148.00 3rd Qu.:145.15 
## Max. :2023-05-31 Max. :182.63 Max. :182.94 Max. :179.12 
## Close Volume Adjusted 
## Min. : 35.55 Min. : 35195900 Min. : 33.87 
## 1st Qu.: 52.03 1st Qu.: 76144000 1st Qu.: 49.73 
## Median :114.97 Median : 98135650 Median :111.96 
## Mean :102.48 Mean :112825725 Mean :100.02 
## 3rd Qu.:146.61 3rd Qu.:133535000 3rd Qu.:143.97 
## Max. :182.01 Max. :426510000 Max. :178.65
&lt;/code>&lt;/pre>&lt;h2 id="kdj指标计算原理">KDJ指标计算原理&lt;/h2>
&lt;p>KDJ指标由三条曲线组成：K线、D线和J线。其计算基于以下步骤：&lt;/p></description></item><item><title>MACD指标择时交易策略分析</title><link>https://rfinance.org.cn/post/macd/</link><pubDate>Tue, 10 Jun 2025 15:36:25 +0000</pubDate><guid>https://rfinance.org.cn/post/macd/</guid><description>&lt;h1 id="引言">引言&lt;/h1>
&lt;p>技术分析是金融市场中常用的分析方法，其中MACD指标是一种重要的趋势跟踪指标，能够反
映价格波动的趋势和动量。本研究旨在通过R语言实现基于MACD指标的股票择时交易策略，并
通过历史数据回测寻找最佳参数组合。&lt;/p>
&lt;h1 id="研究方法">研究方法&lt;/h1>
&lt;h2 id="数据获取与处理">数据获取与处理&lt;/h2>
&lt;p>我们将使用&lt;code>quantmod&lt;/code>包获取股票数据，并使用&lt;code>quantstrat&lt;/code>包进行策略回测。首先加载所需的包：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载必要的包&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantmod)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantstrat)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(eTTR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(PerformanceAnalytics)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(ggplot2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(tibble)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(scales)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(gridExtra)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(showtext)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">font_add&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;SimHei&amp;#34;&lt;/span>, regular &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;SimHei.ttf&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">showtext_auto&lt;/span>()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>接下来，我们获取TSLA的历史数据作为研究对象：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置获取数据的起始和结束日期&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>startdate.st &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2018-01-01&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>enddate.st &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;2023-06-01&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取上证指数数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">getSymbols&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;TSLA&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> src &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;yahoo&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from &lt;span style="color:#f92672">=&lt;/span> startdate.st, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> to &lt;span style="color:#f92672">=&lt;/span> enddate.st)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## [1] &amp;#34;TSLA&amp;#34;
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">colnames&lt;/span>(TSLA) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Open&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;High&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Low&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Close&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Volume&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Adjusted&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看数据结构&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">head&lt;/span>(TSLA)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Open High Low Close Volume Adjusted
## 2018-01-02 20.80000 21.47400 20.73333 21.36867 65283000 21.36867
## 2018-01-03 21.40000 21.68333 21.03667 21.15000 67822500 21.15000
## 2018-01-04 20.85800 21.23667 20.37867 20.97467 149194500 20.97467
## 2018-01-05 21.10800 21.14933 20.80000 21.10533 68868000 21.10533
## 2018-01-08 21.06667 22.46800 21.03333 22.42733 147891000 22.42733
## 2018-01-09 22.34400 22.58667 21.82667 22.24600 107199000 22.24600
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">summary&lt;/span>(TSLA)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Index Open High Low 
## Min. :2018-01-02 Min. : 12.07 Min. : 12.45 Min. : 11.80 
## 1st Qu.:2019-05-10 1st Qu.: 21.42 1st Qu.: 21.82 1st Qu.: 21.04 
## Median :2020-09-15 Median :126.48 Median :130.84 Median :122.50 
## Mean :2020-09-14 Mean :135.13 Mean :138.26 Mean :131.71 
## 3rd Qu.:2022-01-20 3rd Qu.:230.08 3rd Qu.:235.64 3rd Qu.:224.40 
## Max. :2023-05-31 Max. :411.47 Max. :414.50 Max. :405.67 
## Close Volume Adjusted 
## Min. : 11.93 Min. : 29401800 Min. : 11.93 
## 1st Qu.: 21.50 1st Qu.: 77479900 1st Qu.: 21.50 
## Median :125.58 Median :105881850 Median :125.58 
## Mean :135.07 Mean :134180816 Mean :135.07 
## 3rd Qu.:231.07 3rd Qu.:159549600 3rd Qu.:231.07 
## Max. :409.97 Max. :914082000 Max. :409.97
&lt;/code>&lt;/pre>&lt;h2 id="macd指标计算原理">MACD指标计算原理&lt;/h2>
&lt;p>MACD指标由三条曲线组成：DIF线、DEA线和MACD柱状图。其计算基于以下步骤：&lt;/p></description></item><item><title>R语言与多股票波动性及相关性的可视化</title><link>https://rfinance.org.cn/post/chart-muti-stocks/</link><pubDate>Tue, 10 Jun 2025 15:36:25 +0000</pubDate><guid>https://rfinance.org.cn/post/chart-muti-stocks/</guid><description>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>在量化投资建模过程之前，有时候，我们需要对多只股票的价格走势、收益率序列、波动率等进行分析。下面给出使用 R 语言比较多只股票价格走势的完整解决方案。方案涵盖数据获取、清洗、可视化及基础分析全流程：&lt;/p>
&lt;h1 id="数据获取">数据获取&lt;/h1>
&lt;h2 id="安装与加载工具包">安装与加载工具包&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 安装必要包（首次运行需取消注释）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># install.packages(c(&amp;#34;quantmod&amp;#34;, &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#34;tidyverse&amp;#34;, &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#34;ggplot2&amp;#34;, &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#34;zoo&amp;#34;, &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;#34;corrplot&amp;#34;))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantmod) &lt;span style="color:#75715e"># 获取金融数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(tidyverse) &lt;span style="color:#75715e"># 数据处理&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(ggplot2) &lt;span style="color:#75715e"># 可视化&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(zoo) &lt;span style="color:#75715e"># 时间序列处理&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="定义股票代码与时间范围">定义股票代码与时间范围&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 股票代码列表（支持多市场，如A股需加 .SS/.SZ）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 苹果、谷歌、微软、英伟达&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stocks &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;AAPL&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;GOOGL&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;MSFT&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;NVDA&amp;#34;&lt;/span>) 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 时间范围&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#e6db74">&amp;#34;2023-01-01&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">Sys.Date&lt;/span>() &lt;span style="color:#75715e"># 获取当前日期&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="批量获取股票数据">批量获取股票数据&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">getSymbols&lt;/span>(stocks, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> src &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;yahoo&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from &lt;span style="color:#f92672">=&lt;/span> start_date, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> to &lt;span style="color:#f92672">=&lt;/span> end_date)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## [1] &amp;#34;AAPL&amp;#34; &amp;#34;GOOGL&amp;#34; &amp;#34;MSFT&amp;#34; &amp;#34;NVDA&amp;#34;
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 处理数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stock_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">lapply&lt;/span>(stocks, &lt;span style="color:#66d9ef">function&lt;/span>(x) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">as_tibble&lt;/span>(&lt;span style="color:#a6e22e">get&lt;/span>(x)) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">mutate&lt;/span>(Date &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">index&lt;/span>(&lt;span style="color:#a6e22e">get&lt;/span>(x))) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rename_with&lt;/span>(&lt;span style="color:#f92672">~&lt;/span> &lt;span style="color:#a6e22e">gsub&lt;/span>(&lt;span style="color:#a6e22e">paste0&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;^&amp;#34;&lt;/span>, x, &lt;span style="color:#e6db74">&amp;#34;\\.&amp;#34;&lt;/span>), &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, .x)) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">select&lt;/span>(Date, Close) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">mutate&lt;/span>(symbol &lt;span style="color:#f92672">=&lt;/span> x) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span> &lt;span style="color:#75715e"># 添加股票代码列&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rename&lt;/span>(price &lt;span style="color:#f92672">=&lt;/span> Close) &lt;span style="color:#75715e"># 重命名收盘价列&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">bind_rows&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 查看结果&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">head&lt;/span>(stock_data)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## # A tibble: 6 × 3
## Date price symbol
## &amp;lt;date&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; 
## 1 2023-01-03 125. AAPL 
## 2 2023-01-04 126. AAPL 
## 3 2023-01-05 125. AAPL 
## 4 2023-01-06 130. AAPL 
## 5 2023-01-09 130. AAPL 
## 6 2023-01-10 131. AAPL
&lt;/code>&lt;/pre>&lt;h1 id="数据清洗">数据清洗&lt;/h1>
&lt;h2 id="处理缺失值">处理缺失值&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 检查缺失值&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>missing_values &lt;span style="color:#f92672">&amp;lt;-&lt;/span> stock_data &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">group_by&lt;/span>(symbol) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">summarise&lt;/span>(missing &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">sum&lt;/span>(&lt;span style="color:#a6e22e">is.na&lt;/span>(price)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 填充缺失值（使用前向填充）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stock_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> stock_data &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">group_by&lt;/span>(symbol) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">mutate&lt;/span>(price &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">na.locf&lt;/span>(price))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="对齐时间序列">对齐时间序列&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 生成完整日期序列&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>full_dates &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">tibble&lt;/span>(Date &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">seq&lt;/span>(&lt;span style="color:#a6e22e">as.Date&lt;/span>(start_date), 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">as.Date&lt;/span>(end_date), 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> by &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;day&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 左连接填充所有日期&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stock_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> full_dates &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">left_join&lt;/span>(stock_data, by &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Date&amp;#34;&lt;/span>) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">group_by&lt;/span>(symbol) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fill&lt;/span>(price, .direction &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;downup&amp;#34;&lt;/span>) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">na.omit&lt;/span>()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="价格走势可视化">价格走势可视化&lt;/h1>
&lt;h2 id="基础折线图">基础折线图&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">ggplot&lt;/span>(stock_data, &lt;span style="color:#a6e22e">aes&lt;/span>(x &lt;span style="color:#f92672">=&lt;/span> Date, y &lt;span style="color:#f92672">=&lt;/span> price, color &lt;span style="color:#f92672">=&lt;/span> symbol)) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">geom_line&lt;/span>(linewidth &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0.8&lt;/span>) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">labs&lt;/span>(title &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;多只股票价格走势对比&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;日期&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;收盘价&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;股票代码&amp;#34;&lt;/span>) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">theme_minimal&lt;/span>() &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">theme&lt;/span>(legend.position &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;top&amp;#34;&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">scale_color_manual&lt;/span>(values &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;AAPL&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;red&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;GOOGL&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;blue&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;MSFT&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;green&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;NVDA&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;purple&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;img src="https://rfinance.org.cn/post/chart-muti-stocks_files/figure-html/lineChart-1.png" width="90%" style="display: block; margin: auto;" />
&lt;h2 id="对数收益率对比">对数收益率对比&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 计算对数收益率&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>return_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> stock_data &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">group_by&lt;/span>(symbol) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">mutate&lt;/span>(log_return &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">log&lt;/span>(price) &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">lag&lt;/span>(price))) &lt;span style="color:#f92672">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">na.omit&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 绘制收益率曲线&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">ggplot&lt;/span>(return_data, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">aes&lt;/span>(x &lt;span style="color:#f92672">=&lt;/span> Date, y &lt;span style="color:#f92672">=&lt;/span> log_return, color &lt;span style="color:#f92672">=&lt;/span> symbol)) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">geom_line&lt;/span>(alpha &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0.7&lt;/span>) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">labs&lt;/span>(title &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;对数收益率对比&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;日期&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> y &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;对数收益率&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> color &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;股票代码&amp;#34;&lt;/span>) &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">theme_minimal&lt;/span>() &lt;span style="color:#f92672">+&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">theme&lt;/span>(legend.position &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;top&amp;#34;&lt;/span>) &lt;span style="color:#75715e"># 图例放底部&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;img src="https://rfinance.org.cn/post/chart-muti-stocks_files/figure-html/logReturn-1.png" width="90%" style="display: block; margin: auto;" />
&lt;p>绘制对数收益率密度图：&lt;/p></description></item><item><title>基于动量轮动策略的有效性分析</title><link>https://rfinance.org.cn/post/momentum-rotation/</link><pubDate>Tue, 10 Jun 2025 15:36:25 +0000</pubDate><guid>https://rfinance.org.cn/post/momentum-rotation/</guid><description>&lt;h1 id="引言">引言&lt;/h1>
&lt;p>动量效应是金融市场中一种重要的现象，指过去表现较好的资产在未来短期内往往继续表现
较好，而过去表现较差的资产则继续表现较差。基于动量效应的交易策略已经被广泛研究和
应用。&lt;/p>
&lt;p>在股票市场中，大盘股和小盘股通常具有不同的风险收益特征和市场表现。本研究旨在探索
一种基于动量的轮动策略，通过比较大盘股和小盘股的相对强度，动态调整投资组合的配置，
以获取超额收益。&lt;/p>
&lt;p>我们将使用R语言实现这一策略，并通过历史数据验证其有效性。同时，我们会优化策略参数，
测试参数敏感性，并在样本外数据上验证策略的稳健性。&lt;/p>
&lt;h1 id="数据准备与分析">数据准备与分析&lt;/h1>
&lt;p>首先加载必要的R包并获取股票数据。我们将选取多只大盘股和小盘股作为研究对象。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载必要的R包&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(quantmod)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(PerformanceAnalytics)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(foreach)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(doParallel)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(ggplot2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(dplyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(tidyr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(caret)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">library&lt;/span>(magrittr)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>接下来，我们获取股票数据。我们将选择10只大盘股和10只小盘股作为样本。大盘股选取标
普500指数成分股中市值最大的10只，小盘股选取罗素2000指数成分股中市值最小的10只。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 设置起止日期&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>start_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#e6db74">&amp;#34;2018-01-01&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#e6db74">&amp;#34;2023-01-01&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>out_of_sample_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#e6db74">&amp;#34;2023-01-02&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>end_oos_date &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#e6db74">&amp;#34;2023-12-31&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 大盘股列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>large_cap_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;AAPL&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;MSFT&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;AMZN&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;TSLA&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 小盘股列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>small_cap_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ARQT&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;AVXL&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;BPMC&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;CELZ&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 所有股票代码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(large_cap_symbols, small_cap_symbols)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取股票数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stock_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">list&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (symbol &lt;span style="color:#66d9ef">in&lt;/span> all_symbols) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tryCatch&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stock_data_raw &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">getSymbols&lt;/span>(symbol, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from &lt;span style="color:#f92672">=&lt;/span> start_date, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> to &lt;span style="color:#f92672">=&lt;/span> end_date, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> auto.assign &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">colnames&lt;/span>(stock_data_raw) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Open&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;High&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Low&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Close&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Volume&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Adjusted&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stock_data[[symbol]] &lt;span style="color:#f92672">&amp;lt;-&lt;/span> stock_data_raw
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">cat&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Successfully downloaded&amp;#34;&lt;/span>, symbol, &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> error &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">cat&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error downloading&amp;#34;&lt;/span>, symbol, &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">conditionMessage&lt;/span>(e), &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Successfully downloaded AAPL 
## Successfully downloaded MSFT 
## Successfully downloaded AMZN 
## Successfully downloaded TSLA 
## Successfully downloaded ARQT 
## Successfully downloaded AVXL 
## Successfully downloaded BPMC 
## Successfully downloaded CELZ
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-r" data-lang="r">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 过滤掉下载失败的股票&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>valid_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">names&lt;/span>(stock_data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>large_cap_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> large_cap_symbols[large_cap_symbols &lt;span style="color:#f92672">%in%&lt;/span> valid_symbols]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>small_cap_symbols &lt;span style="color:#f92672">&amp;lt;-&lt;/span> small_cap_symbols[small_cap_symbols &lt;span style="color:#f92672">%in%&lt;/span> valid_symbols]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 获取样本外数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>oos_data &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">list&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (symbol &lt;span style="color:#66d9ef">in&lt;/span> valid_symbols) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">tryCatch&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> oss_data_raw &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">getSymbols&lt;/span>(symbol, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> from &lt;span style="color:#f92672">=&lt;/span> out_of_sample_date, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> to &lt;span style="color:#f92672">=&lt;/span> end_oos_date, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> auto.assign &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">FALSE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">colnames&lt;/span>(oss_data_raw) &lt;span style="color:#f92672">&amp;lt;-&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Open&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;High&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Low&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Close&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Volume&amp;#34;&lt;/span>, 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;Adjusted&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> oos_data[[symbol]] &lt;span style="color:#f92672">&amp;lt;-&lt;/span> oss_data_raw
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">cat&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Successfully downloaded OOS data for&amp;#34;&lt;/span>, symbol, &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> error &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">cat&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Error downloading OOS data for&amp;#34;&lt;/span>, symbol, &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">conditionMessage&lt;/span>(e), &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>## Successfully downloaded OOS data for AAPL 
## Successfully downloaded OOS data for MSFT 
## Successfully downloaded OOS data for AMZN 
## Successfully downloaded OOS data for TSLA 
## Successfully downloaded OOS data for ARQT 
## Successfully downloaded OOS data for AVXL 
## Successfully downloaded OOS data for BPMC 
## Successfully downloaded OOS data for CELZ
&lt;/code>&lt;/pre>&lt;p>让我们计算并可视化大盘股和小盘股的平均价格走势，以便对数据有一个直观的了解。&lt;/p></description></item></channel></rss>